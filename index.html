<meta charset="utf-8"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{image-rendering:pixelated;left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%)scale(2,2)}</style><body><script>(()=>{"use strict";function t(t,e,n=!1){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d");return o.imageSmoothingEnabled=n,[i,o]}const e=["objects","ground","grid"],n=Object.fromEntries(e.map(((t,e)=>[t,e]))),i=new Map;let o=0;function l(t,e){return o+=1,i.set(o,[n[t],e]),o}const s={build:{width:0},info:{width:0}},r=Object.keys(s);let f="build";const a={tab:{build:{type:"tab",name:"build"},info:{type:"tab",name:"info"}},menu:{type:"menu"}};function c(t,e){return t?"#fff":e?"#fff3":"#000"}class u{x;y;constructor(t,e){this.x=t,this.y=e}add(t){return new u(this.x+t.x,this.y+t.y)}mul(t){return new u(this.x*t,this.y*t)}sub(t){return new u(this.x-t.x,this.y-t.y)}round(){return new u(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance(t){return((this.x-t.x)**2+(this.y-t.y)**2)**.5}empty(){return isNaN(this.x)||isNaN(this.y)}static zero=new u(0,0);static empty=new u(NaN,NaN)}const[d,h]=t(500,500);d.style.background="#000";let y,x,m=u.zero,w=1,p=u.empty,b=u.empty,g=u.empty,S=u.empty,v=!1;function N({clientX:t,clientY:e}={clientX:NaN,clientY:NaN}){const n=d.getBoundingClientRect();p=new u(500/n.width*(t-n.left),500/n.height*(e-n.top)),b=p.sub(new u(250,250)).mul(1/w).add(m),y=function({x:t,y:e}){if(e<400)return;let n=0;for(const i of r){if(t>n&&t<n+s[i].width&&e<420)return a.tab[i];n+=s[i].width}return a.menu}(p)}function R(t){return t.sub(p.sub(new u(250,250)).mul(1/w))}function k(){g=u.empty,S=u.empty,x=void 0,v=!1}function M(){h.resetTransform()}function T(t){return Math.floor(t/24)}function E(t,e=0){return 24*(T(t)+e)}let L=0;const B=new Set([["base",new u(-1,-3)],["solar",new u(-2,-1)],["battery",new u(-3,-1)],["turret",new u(-4,-1)]]),A={base:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(24*e,24*n,72,72),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ’©",24*(e+1.5),24*(n+1.5)+1)},width:3,height:3},solar:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(24*e,24*n,24,24),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŒž",24*(e+.5),24*(n+.5)+1)},width:1,height:1},battery:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(24*e,24*n,24,24),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”‹",24*(e+.5),24*(n+.5)+1)},width:1,height:1},turret:{draw:(t,{x:e,y:n})=>{t.fillStyle="salmon",t.fillRect(24*e,24*n,24,24),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”«",24*(e+.5),24*(n+.5)+1)},width:1,height:1}};function D(t,{x:e,y:n},{width:i,height:o}){t.strokeStyle="white",t.setLineDash([5,5]),t.lineDashOffset=Math.floor(L/60*-20),t.strokeRect(24*e+.5,24*n+.5,24*i-1,24*o-1),t.setLineDash([])}function j(t,e,n,i,o,l){return t>=n&&t<=o&&e>=i&&e<=l}document.title="space-td";let O=0;document.body.style.background="#49f",document.body.append(d),document.addEventListener("mousemove",(t=>{N(t),!v&&g.distance(p)>5&&(v=!0),v&&(m=R(S))})),d.addEventListener("contextmenu",(t=>{t.preventDefault()})),d.addEventListener("wheel",(t=>{N(t),y||function({deltaY:t}){w=Math.max(.5,Math.min(1.5,w-.125*Math.sign(t))),m=R(b),m=new u(Math.round(m.x*w)/w,Math.round(m.y*w)/w)}(t)})),d.addEventListener("mousedown",(t=>{t.preventDefault(),N(t),y?x=y:(g=p,S=b)})),document.addEventListener("mouseup",(t=>{N(t),y&&y===x&&function(t){"tab"===t.type&&(f=t.name)}(y),k()})),document.addEventListener("visibilitychange",(()=>{p=u.empty,b=u.empty,y=void 0,k()})),l("objects",((t,{x:e,y:n,x1:i,y1:o,x2:l,y2:s})=>{const r=T(e),f=T(n),a=T(i),c=T(o),u=T(l),d=T(s);for(const[e,n]of B)j(n.x,n.y,a-A[e].width+1,c-A[e].height+1,u,d)&&(A[e].draw(t,n),j(r,f,n.x,n.y,n.x+A[e].width-1,n.y+A[e].height-1)&&D(t,n,A[e]))})),l("ground",((t,{x1:e,y1:n,x2:i,y2:o})=>{const l=T(e),s=T(n),r=T(i),f=T(o);if(!(s>0||f<0)){t.fillStyle="sienna";for(let e=l;e<0;e+=1)t.fillRect(24*e,0,24,24);for(let e=1;e<=r;e+=1)t.fillRect(24*e,0,24,24)}})),l("grid",((t,{x1:e,y1:n,x2:i,y2:o})=>{t.beginPath();for(let l=E(e);l<i;l+=24)t.moveTo(l,n),t.lineTo(l,o);for(let l=E(n);l<o;l+=24)t.moveTo(e,l),t.lineTo(i,l);t.lineWidth=1,t.strokeStyle="#fff3",t.stroke()})),function(){const[,e]=t(1e3,1e3);e.font="12px monospace";for(const t of r)s[t].width=Math.round(e.measureText(t).width)+16-1}(),function t(n){requestAnimationFrame(t),n>=O+15.666666666666668&&(O=n,L+=1,M(),h.clearRect(0,0,500,500),h.translate(250,250),h.scale(w,w),h.translate(-m.x,-m.y),function(t,n){const o=e.map((()=>[]));for(const[t,e]of i.values())o[t].push(e);for(const e of o)for(const i of e)i(t,n)}(h,{x:b.x,y:b.y,x1:m.x-251/w,y1:m.y-251/w,x2:m.x+251/w,y2:m.y+151/w}),M(),function(t,e){t.strokeStyle="white",t.strokeRect(.5,400.5,499,99),function(t,e){t.font="12px monospace",t.textAlign="left",t.textBaseline="middle";let n=0;for(const i of r){const o=i===f;t.fillStyle=c(o,"tab"===e?.type&&e.name===i),t.fillRect(n+.5,400.5,s[i].width,20),t.fillStyle=o?"#000":"#fff",t.fillText(i,n+8,411.5),t.strokeStyle="#fff",t.strokeRect(n+.5,400.5,s[i].width,20),n+=s[i].width}}(t,e)}(h,y))}(0);})()</script>
