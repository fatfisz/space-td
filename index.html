<meta charset="utf-8"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{image-rendering:pixelated;left:50%;max-height:49%;max-width:49%;position:fixed;top:50%;transform:translate(-50%,-50%)scale(2,2)}</style><body><script>(()=>{"use strict";function t(t,e,n=!1){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d");return o.imageSmoothingEnabled=n,[i,o]}const e=["objects","ground","grid"],n=Object.fromEntries(e.map(((t,e)=>[t,e]))),i=new Map;let o=0;function l(t,e){return o+=1,i.set(o,[n[t],e]),o}function f(t){return Math.floor(t/24)}let s=0;const r={solar:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(e,n,24,24),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŒž",e+12,n+12+1)},width:24,height:24},battery:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(e,n,24,24),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”‹",e+12,n+12+1)},width:24,height:24},turret:{draw:(t,{x:e,y:n})=>{t.fillStyle="salmon",t.fillRect(e,n,24,24),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”«",e+12,n+12+1)},width:24,height:24}},c={base:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(e,n,72,72),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ’©",e+36,n+36+1)},width:72,height:72},...r},a={...r};function h(t,{x:e,y:n},{width:i,height:o}){t.strokeStyle="white",t.setLineDash([5,5]),t.lineDashOffset=Math.floor(s/60*-20),t.strokeRect(e+.5,n+.5,i-1,o-1),t.setLineDash([])}class d{x;y;constructor(t,e){this.x=t,this.y=e}add(t){return new d(this.x+t.x,this.y+t.y)}mul(t){return new d(this.x*t,this.y*t)}sub(t){return new d(this.x-t.x,this.y-t.y)}round(){return new d(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance(t){return((this.x-t.x)**2+(this.y-t.y)**2)**.5}empty(){return isNaN(this.x)||isNaN(this.y)}within(t,e,n,i){return this.x>=t&&this.x<=t+n&&this.y>=e&&this.y<=e+i}static zero=new d(0,0);static empty=new d(NaN,NaN)}const u={type:"base",topLeft:new d(-24,-72)},y=new Set([u,{type:"solar",topLeft:new d(-48,-24)},{type:"battery",topLeft:new d(-72,-24)},{type:"turret",topLeft:new d(-96,-24)}]);let m=u;function x({x:t,y:e}){const n=new d(f(t),f(e));if(!(n.y>=0))for(const t of y){const{type:e,topLeft:i}=t;if(n.within(i.x,i.y,c[e].width,c[e].height))return t}}function p(){return m}const w={type:"menu"},g=Object.entries(a),b=Object.fromEntries(g.map((([t])=>[t,k(t)]))),S={build:R("build",((t,e)=>{for(const[n,[i,{draw:o}]]of g.entries()){const l=8+72*n+.5;"menuBuildObject"===e?.type&&e.name===i&&(t.fillStyle="#fff3",t.fillRect(l,736.5,64,56)),t.strokeStyle="#fff",t.strokeRect(l,736.5,64,56),t.font="12px monospace",t.textAlign="left",t.textBaseline="middle",t.fillStyle="#fff",t.fillText(i,l+8,749.5),o(t,new d(l+8,760.5))}})),info:R("info",(t=>{const e=p();t.font="12px monospace",t.textAlign="left",t.textBaseline="top",t.fillStyle="#fff",t.fillText(`Selected object: ${e.type}`,8,736,484)}))},v=Object.keys(S);function R(e,n){const[,i]=t(1e3,1e3);return i.font="12px monospace",{draw:n,menuItem:{type:"tab",name:e},width:Math.round(i.measureText(e).width)+16-1}}function k(t){return{type:"menuBuildObject",name:t}}let L="build";function T(t){"tab"===t.type&&(L=t.name),"menuBuildObject"===t.type&&console.log(t.name)}const[B,N]=t(500,800);B.style.background="#000";let M,j,E,A=new d(12,-160),O=1,D=d.empty,Y=d.empty,q=d.empty,C=d.empty,I=!1;function X({clientX:t,clientY:e}={clientX:NaN,clientY:NaN}){const n=B.getBoundingClientRect();D=new d(500/n.width*(t-n.left),800/n.height*(e-n.top)),Y=D.sub(new d(250,400)).mul(1/O).add(A),M=function(t){if(!(t.y<704))return function(t){let e=0;for(const n of v){if(t.within(e,704,S[n].width,24))return S[n].menuItem;e+=S[n].width}}(t)??function(t,e){if("build"===L)for(const[t,[n]]of g.entries())if(e.within(8+72*t+.5,736.5,64,56))return b[n]}(0,t)??w}(D)}function z(t){return t.sub(D.sub(new d(250,400)).mul(1/O))}function F(){q=d.empty,C=d.empty,j=void 0,E=void 0,I=!1}function P(){N.resetTransform()}document.title="space-td";let W=0;document.body.style.background="#49f",document.body.append(B),document.addEventListener("mousemove",(t=>{X(t),!I&&q.distance(D)>5&&(I=!0),I&&(A=z(C))})),B.addEventListener("contextmenu",(t=>{t.preventDefault()})),B.addEventListener("wheel",(t=>{X(t),M||function({deltaY:t}){O=Math.max(.5,Math.min(1.5,O-.125*Math.sign(t))),A=z(Y),A=new d(Math.round(A.x*O)/O,Math.round(A.y*O)/O)}(t)})),B.addEventListener("mousedown",(t=>{t.preventDefault(),X(t),M?E=M:(q=D,C=Y,j=x(Y))})),document.addEventListener("mouseup",(t=>{var e;X(t),M&&M===E&&T(M),!I&&j&&j===x(Y)&&(e=j,T({type:"tab",name:"info"}),m=e),F()})),document.addEventListener("visibilitychange",(()=>{D=d.empty,Y=d.empty,M=void 0,F()})),l("objects",((t,{position:e,x1:n,y1:i,width:o,height:l})=>{for(const f of y){const{type:s,topLeft:r}=f;if(!r.within(n-c[s].width,i-c[s].height,o+c[s].width,l+c[s].height))continue;c[s].draw(t,r);const a=e.within(r.x,r.y,c[s].width,c[s].height);(f===m||a)&&h(t,r,c[s])}})),l("ground",((t,{x1:e,y1:n,x2:i,y2:o})=>{const l=f(e),s=f(i);if(!(n>24||o<0)){t.fillStyle="sienna";for(let e=l;e<0;e+=1)t.fillRect(24*e,0,24,24);for(let e=1;e<=s;e+=1)t.fillRect(24*e,0,24,24)}})),l("grid",((t,{x1:e,y1:n,x2:i,y2:o,width:l,height:s})=>{t.beginPath();for(let l=24*f(e);l<i;l+=24)t.moveTo(l,n),t.lineTo(l,o);for(let l=24*f(n);l<o;l+=24)t.moveTo(e,l),t.lineTo(i,l);t.lineWidth=1,t.strokeStyle="#fff3",t.stroke(),t.strokeRect(e,n,l,s)})),function t(n){requestAnimationFrame(t),n>=W+15.666666666666668&&(W=n,s+=1,P(),N.clearRect(0,0,500,800),N.translate(250,400),N.scale(O,O),N.translate(-A.x,-A.y),function(t,n){const o=e.map((()=>[]));for(const[t,e]of i.values())o[t].push(e);for(const e of o)for(const i of e)i(t,n)}(N,{position:Y,x:Y.x,y:Y.y,x1:A.x-251/O,y1:A.y-401/O,x2:A.x+251/O,y2:A.y+305/O,width:502/O,height:706/O}),P(),function(t,e){t.fillStyle="#000",t.fillRect(0,704,500,96),t.strokeStyle="white",t.strokeRect(.5,704.5,499,95),function(t,e){t.font="12px monospace",t.textAlign="left",t.textBaseline="middle";let n=0;for(const i of v){const o=i===L,l="tab"===e?.type&&e.name===i;t.fillStyle=o?"#fff":l?"#fff3":"#000",t.fillRect(n+.5,704.5,S[i].width,24),t.fillStyle=o?"#000":"#fff",t.fillText(i,n+8,717.5),t.strokeStyle="#fff",t.strokeRect(n+.5,704.5,S[i].width,24),n+=S[i].width}}(t,e),S[L].draw(t,e)}(N,M))}(0);})()</script>
