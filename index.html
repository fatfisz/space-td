<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{image-rendering:pixelated;left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%)scale(3,3)}</style><body><script>(()=>{"use strict";const t=["grid"],e=Object.fromEntries(t.map(((t,e)=>[t,e]))),n=new Map;let i=0;class s{x;y;constructor(t,e){this.x=t,this.y=e}add(t){return new s(this.x+t.x,this.y+t.y)}mul(t){return new s(this.x*t,this.y*t)}sub(t){return new s(this.x-t.x,this.y-t.y)}round(){return new s(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance(t){return((this.x-t.x)**2+(this.y-t.y)**2)**.5}empty(){return isNaN(this.x)||isNaN(this.y)}static zero=new s(0,0);static empty=new s(NaN,NaN)}const[o,a]=function(t,e,n=!1){const i=document.createElement("canvas");i.width=t,i.height=e;const s=i.getContext("2d");return s.imageSmoothingEnabled=n,[i,s]}(320,320);o.style.background="#000";let r=s.zero,u=1,d=s.empty,c=s.empty,l=s.empty,m=s.empty,y=!1;function h(t={clientX:NaN,clientY:NaN}){const e=o.getBoundingClientRect();d=new s(320/e.width*(t.clientX-e.left),320/e.height*(t.clientY-e.top)),c=d.sub(new s(160,160)).mul(1/u).add(r)}function f(t){return t.sub(d.sub(new s(160,160)).mul(1/u))}function x(t,e=0){return 16*(Math.floor(t/16)+e)}document.title="space-td";let p=0;document.body.append(o),o.addEventListener("mousemove",h),document.addEventListener("mousemove",(t=>{l.empty()||(h(t),!y&&l.distance(d)>5&&(y=!0),y&&(r=f(m),h(t)))})),o.addEventListener("contextmenu",(t=>{t.preventDefault()})),o.addEventListener("wheel",(t=>{u=Math.max(.5,Math.min(1,u-.0625*Math.sign(t.deltaY))),r=f(c)})),o.addEventListener("mouseout",(()=>{y||h()})),o.addEventListener("mousedown",(t=>{t.preventDefault(),h(t),l=d,m=c})),o.addEventListener("mouseup",h),document.addEventListener("mouseup",(()=>{!d.empty()&&(d.x<0||d.y<0||d.x>320||d.y>320)&&h(),l=s.empty,m=s.empty,y=!1})),document.addEventListener("visibilitychange",(()=>{h(),l=s.empty,m=s.empty,y=!1})),i+=1,n.set(1,[e.grid,(t,{x:e,y:n,x1:i,y1:s,x2:o,y2:a})=>{isNaN(e)||isNaN(n)||(t.fillStyle="#fff3",t.fillRect(x(e),x(n),16,16)),t.beginPath();for(let e=x(i);e<o;e+=16)t.moveTo(e,s),t.lineTo(e,a);for(let e=x(s);e<a;e+=16)t.moveTo(i,e),t.lineTo(o,e);t.lineWidth=1,t.strokeStyle="#fff",t.stroke(),t.beginPath(),t.fillStyle="#fff",t.arc(0,0,3,0,2*Math.PI),t.fill()}]),function e(i){requestAnimationFrame(e),i>=p+15.666666666666668&&(p=i,a.resetTransform(),a.clearRect(0,0,320,320),a.translate(160,160),a.scale(u,u),a.translate(-r.x,-r.y),function(e,i){const s=t.map((()=>[]));for(const[t,e]of n.values())s[t].push(e);for(const t of s)for(const n of t)n(e,i)}(a,{x:c.x,y:c.y,x1:r.x-161/u,y1:r.y-161/u,x2:r.x+161/u,y2:r.y+161/u}))}(0);})()</script>
