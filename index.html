<meta charset="utf-8"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{image-rendering:pixelated;left:50%;max-height:49%;max-width:49%;position:fixed;top:50%;transform:translate(-50%,-50%)scale(2,2)}</style><body><script>(()=>{"use strict";function t(t,e,n=!1){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d");return o.imageSmoothingEnabled=n,[i,o]}const e=["objects","ground","grid"],n=Object.fromEntries(e.map(((t,e)=>[t,e]))),i=new Map;let o=0;function l(t,e){return o+=1,i.set(o,[n[t],e]),o}function f(t){return Math.floor(t/24)}function s(t,e=0){return 24*(f(t)+e)}let r=0;const c={base:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(24*e,24*n,72,72),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ’©",24*(e+1.5),24*(n+1.5)+1)},width:3,height:3},solar:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(24*e,24*n,24,24),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŒž",24*(e+.5),24*(n+.5)+1)},width:1,height:1},battery:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(24*e,24*n,24,24),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”‹",24*(e+.5),24*(n+.5)+1)},width:1,height:1},turret:{draw:(t,{x:e,y:n})=>{t.fillStyle="salmon",t.fillRect(24*e,24*n,24,24),t.fillStyle="white",t.font="16px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”«",24*(e+.5),24*(n+.5)+1)},width:1,height:1}};function a(t,{x:e,y:n},{width:i,height:o}){t.strokeStyle="white",t.setLineDash([5,5]),t.lineDashOffset=Math.floor(r/60*-20),t.strokeRect(24*e+.5,24*n+.5,24*i-1,24*o-1),t.setLineDash([])}class u{x;y;constructor(t,e){this.x=t,this.y=e}add(t){return new u(this.x+t.x,this.y+t.y)}mul(t){return new u(this.x*t,this.y*t)}sub(t){return new u(this.x-t.x,this.y-t.y)}round(){return new u(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance(t){return((this.x-t.x)**2+(this.y-t.y)**2)**.5}empty(){return isNaN(this.x)||isNaN(this.y)}static zero=new u(0,0);static empty=new u(NaN,NaN)}const d={type:"base",topLeft:new u(-1,-3)},y=new Set([d,{type:"solar",topLeft:new u(-2,-1)},{type:"battery",topLeft:new u(-3,-1)},{type:"turret",topLeft:new u(-4,-1)}]);let h=d;function x({x:t,y:e}){const n=f(t),i=f(e);if(!(i>=0))for(const t of y){const{type:e,topLeft:o}=t;if(p(n,i,o.x,o.y,o.x+c[e].width-1,o.y+c[e].height-1))return t}}function m(){return h}function p(t,e,n,i,o,l){return t>=n&&t<=o&&e>=i&&e<=l}const w={type:"menu"},g={build:S("build",(t=>{})),info:S("info",(t=>{const e=m();t.font="12px monospace",t.textAlign="left",t.textBaseline="top",t.fillStyle="#fff",t.fillText(`Selected object: ${e.type}`,8,744,484)}))},b=Object.keys(g);function S(e,n){const[,i]=t(1e3,1e3);return i.font="12px monospace",{draw:n,menuItem:{type:"tab",name:e},width:Math.round(i.measureText(e).width)+16-1}}let v="build";function L(t){"tab"===t.type&&(v=t.name)}function R(t,e){return t?"#fff":e?"#fff3":"#000"}const[N,T]=t(500,800);N.style.background="#000";let k,M,E,B=new u(12,-160),A=1,j=u.empty,D=u.empty,O=u.empty,Y=u.empty,q=!1;function C({clientX:t,clientY:e}={clientX:NaN,clientY:NaN}){const n=N.getBoundingClientRect();j=new u(500/n.width*(t-n.left),800/n.height*(e-n.top)),D=j.sub(new u(250,400)).mul(1/A).add(B),k=function({x:t,y:e}){if(e<712)return;let n=0;for(const i of b){if(t>n&&t<n+g[i].width&&e<736)return g[i].menuItem;n+=g[i].width}return w}(j)}function I(t){return t.sub(j.sub(new u(250,400)).mul(1/A))}function X(){O=u.empty,Y=u.empty,M=void 0,E=void 0,q=!1}function z(){T.resetTransform()}document.title="space-td";let F=0;document.body.style.background="#49f",document.body.append(N),document.addEventListener("mousemove",(t=>{C(t),!q&&O.distance(j)>5&&(q=!0),q&&(B=I(Y))})),N.addEventListener("contextmenu",(t=>{t.preventDefault()})),N.addEventListener("wheel",(t=>{C(t),k||function({deltaY:t}){A=Math.max(.5,Math.min(1.5,A-.125*Math.sign(t))),B=I(D),B=new u(Math.round(B.x*A)/A,Math.round(B.y*A)/A)}(t)})),N.addEventListener("mousedown",(t=>{t.preventDefault(),C(t),k?E=k:(O=j,Y=D,M=x(D))})),document.addEventListener("mouseup",(t=>{var e;C(t),k&&k===E&&L(k),!q&&M&&M===x(D)&&(e=M,L({type:"tab",name:"info"}),h=e),X()})),document.addEventListener("visibilitychange",(()=>{j=u.empty,D=u.empty,k=void 0,X()})),l("objects",((t,{x:e,y:n,x1:i,y1:o,x2:l,y2:s})=>{const r=f(e),u=f(n),d=f(i),x=f(o),m=f(l),w=f(s);for(const e of y){const{type:n,topLeft:i}=e;if(!p(i.x,i.y,d-c[n].width+1,x-c[n].height+1,m,w))continue;c[n].draw(t,i);const o=p(r,u,i.x,i.y,i.x+c[n].width-1,i.y+c[n].height-1);(e===h||o)&&a(t,i,c[n])}})),l("ground",((t,{x1:e,y1:n,x2:i,y2:o})=>{const l=f(e),s=f(n),r=f(i),c=f(o);if(!(s>0||c<0)){t.fillStyle="sienna";for(let e=l;e<0;e+=1)t.fillRect(24*e,0,24,24);for(let e=1;e<=r;e+=1)t.fillRect(24*e,0,24,24)}})),l("grid",((t,{x1:e,y1:n,x2:i,y2:o})=>{t.beginPath();for(let l=s(e);l<i;l+=24)t.moveTo(l,n),t.lineTo(l,o);for(let l=s(n);l<o;l+=24)t.moveTo(e,l),t.lineTo(i,l);t.lineWidth=1,t.strokeStyle="#fff3",t.stroke()})),function t(n){requestAnimationFrame(t),n>=F+15.666666666666668&&(F=n,r+=1,z(),T.clearRect(0,0,500,800),T.translate(250,400),T.scale(A,A),T.translate(-B.x,-B.y),function(t,n){const o=e.map((()=>[]));for(const[t,e]of i.values())o[t].push(e);for(const e of o)for(const i of e)i(t,n)}(T,{x:D.x,y:D.y,x1:B.x-251/A,y1:B.y-401/A,x2:B.x+251/A,y2:B.y+313/A}),z(),function(t,e){t.fillStyle="#000",t.fillRect(0,712,500,88),t.strokeStyle="white",t.strokeRect(.5,712.5,499,87),function(t,e){t.font="12px monospace",t.textAlign="left",t.textBaseline="middle";let n=0;for(const i of b){const o=i===v;t.fillStyle=R(o,"tab"===e?.type&&e.name===i),t.fillRect(n+.5,712.5,g[i].width,24),t.fillStyle=o?"#000":"#fff",t.fillText(i,n+8,725.5),t.strokeStyle="#fff",t.strokeRect(n+.5,712.5,g[i].width,24),n+=g[i].width}}(t,e),g[v].draw(t)}(T,k))}(0);})()</script>
