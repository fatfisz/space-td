<meta charset="utf-8"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{image-rendering:pixelated;left:50%;max-height:49%;max-width:49%;position:fixed;top:50%;transform:translate(-50%,-50%)scale(2,2)}</style><body><script>(()=>{"use strict";const t=["objects","ground","grid"],e=Object.fromEntries(t.map(((t,e)=>[t,e]))),n=new Map;let i=0;function o(t,o){return i+=1,n.set(i,[e[t],o]),i}function s(t,e){return t+Math.random()*(e-t)}function a(t){return Math.floor(t/24)}function r(t,e,n=!1){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d");return o.imageSmoothingEnabled=n,[i,o]}let f=0;const l={solar:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŒž",e+12,n+12+1)},width:24,height:24},battery:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”‹",e+12,n+12+1)},width:24,height:24},turret:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”«",e+12,n+12+1)},width:24,height:24}},c={base:{draw:(t,{x:e,y:n})=>{t.font="60px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ—¼",e+36,n+36+3)},width:72,height:72},...l},d={...l};function u(t,{x:e,y:n},{width:i,height:o}){t.strokeStyle="#fff",t.setLineDash([5,5]),t.lineDashOffset=Math.floor(f/60*-20),t.strokeRect(e+.5,n+.5,i-1,o-1),t.setLineDash([])}class h{x;y;constructor(t,e){this.x=t,this.y=e}add(t){return new h(this.x+t.x,this.y+t.y)}mul(t){return new h(this.x*t,this.y*t)}sub(t){return new h(this.x-t.x,this.y-t.y)}round(){return new h(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance(t){return((this.x-t.x)**2+(this.y-t.y)**2)**.5}empty(){return isNaN(this.x)||isNaN(this.y)}within(t,e,n,i){return this.x>=t&&this.x<t+n&&this.y>=e&&this.y<e+i}ensureWithin(t,e,n,i){return new h(Math.min(t+n,Math.max(t,this.x)),Math.min(e+i,Math.max(e,this.y)))}static zero=new h(0,0);static empty=new h(NaN,NaN)}const m={type:"menu"},y=Object.entries(d),x=Object.fromEntries(y.map((([t])=>[t,g(t)]))),w={build:b("build",((t,e)=>{for(const[n,[i,{draw:o,width:s}]]of y.entries()){const a=8+72*n+.5,r=i===T,f="menuBuildObject"===e?.type&&e.name===i;t.fillStyle=r?"#fff":f?"#fff4":"#000",t.fillRect(a,736.5,64,56),t.strokeStyle="#fff",t.strokeRect(a,736.5,64,56),t.fillStyle=r?"#000":"#fff",t.font="12px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(i,a+32,749.5),o(t,new h(a+(64-s)/2,760.5))}})),info:b("info",(t=>{const e=void 0!==k?S.get(k):void 0;t.font="12px monospace",t.textAlign="left",t.textBaseline="top",t.fillStyle="#fff",t.fillText(e?`Selected object: ${e}`:"select an object to see more details",8,736,484)}))},p=Object.keys(w);function b(t,e){const[,n]=r(1e3,1e3);return n.font="12px monospace",{draw:e,menuItem:{type:"tab",name:t},width:Math.round(n.measureText(t).width)+16-1}}function g(t){return{type:"menuBuildObject",name:t}}let M="build";function v(t){"tab"===t.type&&(M=t.name),"menuBuildObject"===t.type&&(T=t.name)}const S=new Map([[-1,"base"]]);let k,T,j=-1,B=1;function N(t,e,n){const i=n.within(24*e,-24,24,24);t.strokeStyle=i?"#fff":"#fff8",t.beginPath(),t.arc(24*(e+.5),-12,8,0,2*Math.PI),t.moveTo(24*(e+.3),-12),t.lineTo(24*(e+.7),-12),t.moveTo(24*(e+.5),24*-.3),t.lineTo(24*(e+.5),24*-.7),t.stroke()}function E({x:t,y:e}){const n=a(t),i=n>-1&&n<2?-1:n,o=S.get(i);if(e<=0&&e>=-(o?c[o].height:24))return i}function R(){return[24*j-800,24*(B+1)-1+800]}const A=Math.PI/6,L=new Set;function O(t){t.y<0||(L.delete(t),n.delete(t.drawableHandle))}const[D,I]=r(500,800);D.style.background="#000";let P,X,Y,q=new h(12,-160),C=1,H=h.empty,W=h.empty,z=h.empty,F=h.empty,$=!1;function G({clientX:t,clientY:e}={clientX:NaN,clientY:NaN}){const n=D.getBoundingClientRect();H=new h(500/n.width*(t-n.left),800/n.height*(e-n.top)),W=H.sub(new h(250,400)).mul(1/C).add(q),P=function(t){if(!(t.y<704))return function(t){let e=0;for(const n of p){if(t.within(e,704,w[n].width,24))return w[n].menuItem;e+=w[n].width}}(t)??function(t,e){if("build"===M)for(const[t,[n]]of y.entries())if(e.within(8+72*t+.5,736.5,64,56))return x[n]}(0,t)??m}(H)}function J(t){q=t.sub(H.sub(new h(250,400)).mul(1/C));const[e,n]=R();q=q.ensureWithin(e+251/C,401/C-1200,n-e-502/C,2400-802/C),q=new h(Math.round(q.x*C)/C,Math.round(q.y*C)/C)}function K(){z=h.empty,F=h.empty,X=void 0,Y=void 0,$=!1}function Q(){I.resetTransform()}document.title="space-td";let U=0;document.body.style.background="#49f",document.body.append(D),document.addEventListener("mousemove",(t=>{G(t),!$&&z.distance(H)>5&&($=!0),$&&J(F)})),D.addEventListener("contextmenu",(t=>{t.preventDefault()})),D.addEventListener("wheel",(t=>{G(t),P||function({deltaY:t}){C=Math.max(.5,Math.min(1.5,C-.08333333333333333*Math.sign(t))),J(W)}(t)})),D.addEventListener("mousedown",(t=>{t.preventDefault(),G(t),P?Y=P:(z=H,F=W,X=E(W))})),document.addEventListener("mouseup",(t=>{var e;G(t),P&&P===Y?v(P):$||X!==E(W)||(void 0===(e=X)?(k=void 0,T=void 0):S.has(e)?(k=e,v({type:"tab",name:"info"})):T&&function(t,e){j=Math.min(t,j),B=Math.min(t,B),S.set(t,e)}(e,T)),K()})),document.addEventListener("visibilitychange",(()=>{H=h.empty,W=h.empty,P=void 0,K()})),o("objects",((t,{position:e,x1:n,x2:i})=>{const o=a(n),s=a(i);for(let n=o;n<=s;n+=-1===n?3:1){const i=S.get(n);if(!i){T&&N(t,n,e);continue}const o=new h(24*n,-c[i].height);c[i].draw(t,o);const s=e.within(o.x,o.y,c[i].width,c[i].height);(n===k||s)&&u(t,o,c[i])}})),o("ground",((t,{x1:e,x2:n})=>{const i=a(e),o=a(n);t.fillStyle="sienna";for(let e=i;e<=o;e+=-1===e?2:1)t.fillRect(24*e,0,24,24)})),function e(i){requestAnimationFrame(e),i>=U+15.666666666666668&&(U=i,f+=1,function(){!function(){if(Math.random()>.1)return;const t=s(...R()),e=s(-A,A),n=s(3,5),i={endX:t,mass:s(1,4),x:t+-1300*Math.tan(e),y:-1300,r:0,dr:s(-1e-4,1e-4),dx:Math.sin(e)*n,dy:Math.cos(e)*n,drawableHandle:o("objects",(t=>{t.strokeStyle="#fff",t.beginPath(),t.arc(i.x,i.y,4*2**i.mass,0,2*Math.PI),t.stroke()}))};L.add(i)}();for(const t of L)t.x+=t.dx,t.y+=t.dy,t.r+=t.dr,O(t)}(),Q(),I.clearRect(0,0,500,800),I.translate(250,400),I.scale(C,C),I.translate(-q.x,-q.y),function(e,i){const o=t.map((()=>[]));for(const[t,e]of n.values())o[t].push(e);for(const t of o)for(const n of t)n(e,i)}(I,{position:W,x1:q.x-251/C,y1:q.y-401/C,x2:q.x+251/C,y2:q.y+305/C,width:502/C,height:706/C}),Q(),function(t,e){t.fillStyle="#000",t.fillRect(0,704,500,96),t.strokeStyle="#fff",t.strokeRect(.5,704.5,499,95),function(t,e){t.font="12px monospace",t.textAlign="left",t.textBaseline="middle";let n=0;for(const i of p){const o=i===M,s="tab"===e?.type&&e.name===i;t.fillStyle=o?"#fff":s?"#fff4":"#000",t.fillRect(n+.5,704.5,w[i].width,24),t.fillStyle=o?"#000":"#fff",t.fillText(i,n+8,717.5),t.strokeStyle="#fff",t.strokeRect(n+.5,704.5,w[i].width,24),n+=w[i].width}}(t,e),w[M].draw(t,e)}(I,P))}(0);})()</script>
