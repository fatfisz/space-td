<meta charset="utf-8"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{image-rendering:pixelated;left:50%;max-height:49%;max-width:49%;position:fixed;top:50%;transform:translate(-50%,-50%)scale(2,2)}</style><body><script>(()=>{"use strict";const t=["objects","ground","grid"],e=Object.fromEntries(t.map(((t,e)=>[t,e]))),n=new Map;let i=0;function o(t,o){return i+=1,n.set(i,[e[t],o]),i}function s(t,e){return t+Math.random()*(e-t)}function a(t){return Math.floor(t/24)}function f(t,e,n=!1){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d");return o.imageSmoothingEnabled=n,[i,o]}let r=0;const l={solar:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŒž",e+12,n+12+1)},width:24,height:24},battery:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”‹",e+12,n+12+1)},width:24,height:24},turret:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”«",e+12,n+12+1)},width:24,height:24}},c={base:{draw:(t,{x:e,y:n})=>{t.font="60px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ—¼",e+36,n+36+3)},width:72,height:72},...l},d={...l};function u(t,{x:e,y:n},{width:i,height:o}){t.strokeStyle="#fff",t.setLineDash([5,5]),t.lineDashOffset=Math.floor(r/60*-20),t.strokeRect(e+.5,n+.5,i-1,o-1),t.setLineDash([])}class h{x;y;constructor(t,e){this.x=t,this.y=e}add(t){return new h(this.x+t.x,this.y+t.y)}mul(t){return new h(this.x*t,this.y*t)}sub(t){return new h(this.x-t.x,this.y-t.y)}round(){return new h(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance(t){return((this.x-t.x)**2+(this.y-t.y)**2)**.5}empty(){return isNaN(this.x)||isNaN(this.y)}within(t,e,n,i){return this.x>=t&&this.x<t+n&&this.y>=e&&this.y<e+i}ensureWithin(t,e,n,i){return new h(Math.min(t+n,Math.max(t,this.x)),Math.min(e+i,Math.max(e,this.y)))}static zero=new h(0,0);static empty=new h(NaN,NaN)}const m={type:"menu"},y=Object.entries(d),x=Object.fromEntries(y.map((([t])=>[t,g(t)]))),w={build:b("build",((t,e)=>{for(const[n,[i,{draw:o,width:s}]]of y.entries()){const a=8+72*n+.5,f=i===T,r="menuBuildObject"===e?.type&&e.name===i;t.fillStyle=f?"#fff":r?"#fff4":"#000",t.fillRect(a,736.5,64,56),t.strokeStyle="#fff",t.strokeRect(a,736.5,64,56),t.fillStyle=f?"#000":"#fff",t.font="12px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(i,a+32,749.5),o(t,new h(a+(64-s)/2,760.5))}})),info:b("info",(t=>{const e=void 0!==k?S.get(k):void 0;t.font="12px monospace",t.textAlign="left",t.textBaseline="top",t.fillStyle="#fff",t.fillText(e?`Selected object: ${e}`:"select an object to see more details",8,736,484)}))},p=Object.keys(w);function b(t,e){const[,n]=f(1e3,1e3);return n.font="12px monospace",{draw:e,menuItem:{type:"tab",name:t},width:Math.round(n.measureText(t).width)+16-1}}function g(t){return{type:"menuBuildObject",name:t}}let M="build";function v(t){"tab"===t.type&&(M=t.name),"menuBuildObject"===t.type&&(T=t.name)}const S=new Map([[-1,"base"]]);let k,T,j=-1,B=1;function N(t,e,n){const i=n.within(24*e,-24,24,24);t.strokeStyle=i?"#fff":"#fff8",t.beginPath(),t.arc(24*(e+.5),-12,8,0,2*Math.PI),t.moveTo(24*(e+.3),-12),t.lineTo(24*(e+.7),-12),t.moveTo(24*(e+.5),24*-.3),t.lineTo(24*(e+.5),24*-.7),t.stroke()}function E({x:t,y:e}){const n=a(t),i=n>-1&&n<2?-1:n,o=S.get(i);if(e<=0&&e>=-(o?c[o].height:24))return i}function R(t){void 0===t?(k=void 0,T=void 0):S.has(t)?(k=t,v({type:"tab",name:"info"})):T&&function(t,e){j=Math.min(t,j),B=Math.min(t,B),S.set(t,e)}(t,T)}function A(){return[24*j-800,24*(B+1)-1+800]}const L=Math.PI/6,O=new Set;function D(t){t.y<0||(O.delete(t),n.delete(t.drawableHandle))}const[I,P]=f(500,800);I.style.background="#000";let Y,q,C,H=new h(12,-160),W=1,X=h.empty,z=h.empty,F=h.empty,$=h.empty,G=!1;function J({clientX:t,clientY:e}={clientX:NaN,clientY:NaN}){const n=I.getBoundingClientRect();X=new h(500/n.width*(t-n.left),800/n.height*(e-n.top)),z=X.sub(new h(250,400)).mul(1/W).add(H),Y=function(t){if(!(t.y<704))return function(t){let e=0;for(const n of p){if(t.within(e,704,w[n].width,24))return w[n].menuItem;e+=w[n].width}}(t)??function(t,e){if("build"===M)for(const[t,[n]]of y.entries())if(e.within(8+72*t+.5,736.5,64,56))return x[n]}(0,t)??m}(X)}function K(t){H=t.sub(X.sub(new h(250,400)).mul(1/W));const[e,n]=A();H=H.ensureWithin(e+251/W,401/W-1200,n-e-502/W,2400-802/W),H=new h(Math.round(H.x*W)/W,Math.round(H.y*W)/W)}function Q(){F=h.empty,$=h.empty,q=void 0,C=void 0,G=!1}function U(){P.resetTransform()}document.title="space-td";let V=0;document.body.style.background="#49f",document.body.append(I),document.addEventListener("mousemove",(t=>{J(t),!G&&F.distance(X)>5&&(G=!0),G&&K($)})),I.addEventListener("contextmenu",(t=>{t.preventDefault()})),I.addEventListener("wheel",(t=>{J(t),Y||function({deltaY:t}){W=Math.max(.5,Math.min(1.5,W-.08333333333333333*Math.sign(t))),K(z)}(t)})),I.addEventListener("mousedown",(t=>{t.preventDefault(),J(t),Y?C=Y:(F=X,$=z,q=E(z))})),document.addEventListener("mouseup",(t=>{J(t),Y&&Y===C?(R(void 0),v(Y)):G||q!==E(z)||R(q),Q()})),document.addEventListener("visibilitychange",(()=>{X=h.empty,z=h.empty,Y=void 0,Q()})),o("objects",((t,{position:e,x1:n,x2:i})=>{const o=a(n),s=a(i);for(let n=o;n<=s;n+=-1===n?3:1){const i=S.get(n);if(!i){T&&N(t,n,e);continue}const o=new h(24*n,-c[i].height);c[i].draw(t,o);const s=e.within(o.x,o.y,c[i].width,c[i].height);(n===k||s)&&u(t,o,c[i])}})),o("ground",((t,{x1:e,x2:n})=>{const i=a(e),o=a(n);t.fillStyle="sienna";for(let e=i;e<=o;e+=-1===e?2:1)t.fillRect(24*e,0,24,24)})),function e(i){requestAnimationFrame(e),i>=V+15.666666666666668&&(V=i,r+=1,function(){!function(){if(Math.random()>.1)return;const t=s(-L,L),e=s(3,5),n={mass:s(1,4),x:s(...A())+-1300*Math.tan(t),y:-1300,r:0,dr:s(-1e-4,1e-4),dx:Math.sin(t)*e,dy:Math.cos(t)*e,drawableHandle:o("objects",(t=>{t.strokeStyle="#fff",t.beginPath(),t.arc(n.x,n.y,4*2**n.mass,0,2*Math.PI),t.stroke()}))};O.add(n)}();for(const t of O)t.x+=t.dx,t.y+=t.dy,t.r+=t.dr,D(t)}(),U(),P.clearRect(0,0,500,800),P.translate(250,400),P.scale(W,W),P.translate(-H.x,-H.y),function(e,i){const o=t.map((()=>[]));for(const[t,e]of n.values())o[t].push(e);for(const t of o)for(const n of t)n(e,i)}(P,{position:z,x1:H.x-251/W,y1:H.y-401/W,x2:H.x+251/W,y2:H.y+305/W,width:502/W,height:706/W}),U(),function(t,e){t.fillStyle="#000",t.fillRect(0,704,500,96),t.strokeStyle="#fff",t.strokeRect(.5,704.5,499,95),function(t,e){t.font="12px monospace",t.textAlign="left",t.textBaseline="middle";let n=0;for(const i of p){const o=i===M,s="tab"===e?.type&&e.name===i;t.fillStyle=o?"#fff":s?"#fff4":"#000",t.fillRect(n+.5,704.5,w[i].width,24),t.fillStyle=o?"#000":"#fff",t.fillText(i,n+8,717.5),t.strokeStyle="#fff",t.strokeRect(n+.5,704.5,w[i].width,24),n+=w[i].width}}(t,e),w[M].draw(t,e)}(P,Y))}(0);})()</script>
