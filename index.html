<meta charset="utf-8"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{image-rendering:pixelated;left:50%;max-height:49%;max-width:49%;position:fixed;top:50%;transform:translate(-50%,-50%)scale(2,2)}</style><body><script>(()=>{"use strict";const t=["objects","ground"],e=Object.fromEntries(t.map(((t,e)=>[t,e]))),n=new Map;let i=0;function o(t,o){return i+=1,n.set(i,[e[t],o]),i}function s(t,e){return t+Math.random()*(e-t)}function f(t){return Math.floor(t/24)}function r(t,e,n=!1){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d");return o.imageSmoothingEnabled=n,[i,o]}let a=0;const l={solar:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŒž",e+12,n+12+1)},width:24,height:24},battery:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”‹",e+12,n+12+1)},width:24,height:24},turret:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”«",e+12,n+12+1)},width:24,height:24}},c={base:{draw:(t,{x:e,y:n})=>{t.font="60px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ—¼",e+36,n+36+3)},width:72,height:72},...l},d={...l};function h(t,{x:e,y:n},{width:i,height:o}){t.strokeStyle="#fff",t.setLineDash([5,5]),t.lineDashOffset=Math.floor(a/60*-20),t.strokeRect(e+.5,n+.5,i-1,o-1),t.setLineDash([])}class u{x;y;constructor(t,e){this.x=t,this.y=e}add(t){return new u(this.x+t.x,this.y+t.y)}mul(t){return new u(this.x*t,this.y*t)}sub(t){return new u(this.x-t.x,this.y-t.y)}round(){return new u(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance(t){return((this.x-t.x)**2+(this.y-t.y)**2)**.5}empty(){return isNaN(this.x)||isNaN(this.y)}within(t,e,n,i){return this.x>=t&&this.x<t+n&&this.y>=e&&this.y<e+i}ensureWithin(t,e,n,i){return new u(Math.min(t+n,Math.max(t,this.x)),Math.min(e+i,Math.max(e,this.y)))}static zero=new u(0,0);static empty=new u(NaN,NaN)}const m={type:"menu"},x=Object.entries(d),y=Object.fromEntries(x.map((([t])=>[t,b(t)]))),p={build:g("build",((t,e)=>{for(const[n,[i,{draw:o,width:s}]]of x.entries()){const f=8+72*n+.5,r=i===T,a="menuBuildObject"===e?.type&&e.name===i;t.fillStyle=r?"#fff":a?"#fff4":"#000",t.fillRect(f,736.5,64,56),t.strokeStyle="#fff",t.strokeRect(f,736.5,64,56),t.fillStyle=r?"#000":"#fff",t.font="12px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(i,f+32,749.5),o(t,new u(f+(64-s)/2,760.5))}})),info:g("info",(t=>{const e=void 0!==k?S.get(k):void 0;t.font="12px monospace",t.textAlign="left",t.textBaseline="top",t.fillStyle="#fff",t.fillText(e?`Selected object: ${e}`:"select an object to see more details",8,736,484)}))},w=Object.keys(p);function g(t,e){const[,n]=r(1e3,1e3);return n.font="12px monospace",{draw:e,menuItem:{type:"tab",name:t},width:Math.round(n.measureText(t).width)+16-1}}function b(t){return{type:"menuBuildObject",name:t}}let M="build";function v(t){"tab"===t.type&&(M=t.name),"menuBuildObject"===t.type&&(T=t.name)}const S=new Map([[-1,"base"]]);let k,T,j=-1,B=1;function N(t,e,n){const i=n.within(24*e,-24,24,24);t.strokeStyle=i?"#fff":"#fff8",t.beginPath(),t.arc(24*(e+.5),-12,8,0,2*Math.PI),t.moveTo(24*(e+.3),-12),t.lineTo(24*(e+.7),-12),t.moveTo(24*(e+.5),24*-.3),t.lineTo(24*(e+.5),24*-.7),t.stroke()}function O({x:t,y:e}){const n=f(t),i=n>-1&&n<2?-1:n,o=S.get(i);if(e<=0&&e>=-(o?c[o].height:24))return i}function E(t){void 0===t?(k=void 0,T=void 0):S.has(t)?(k=t,v({type:"tab",name:"info"})):T&&function(t,e){j=Math.min(t,j),B=Math.min(t,B),S.set(t,e)}(t,T)}function R(){return[24*j-500,24*(B+1)-1+500]}const A=Math.PI/6,L=new Set;function P(t){t.position.y<0||(L.delete(t),n.delete(t.drawableHandle))}function D(t){const e=2*Math.round(t)+3,n=[];for(let t=0;t<e;t+=1)n.push(s(.5,1));return n}const[I,Y]=r(500,800);I.style.background="#000";let q,z,C,H=new u(12,-160),W=1,X=u.empty,F=u.empty,$=u.empty,G=u.empty,J=!1;function K({clientX:t,clientY:e}={clientX:NaN,clientY:NaN}){const n=I.getBoundingClientRect();X=new u(500/n.width*(t-n.left),800/n.height*(e-n.top)),F=X.sub(new u(250,400)).mul(1/W).add(H),q=function(t){if(!(t.y<704))return function(t){let e=0;for(const n of w){if(t.within(e,704,p[n].width,24))return p[n].menuItem;e+=p[n].width}}(t)??function(t,e){if("build"===M)for(const[t,[n]]of x.entries())if(e.within(8+72*t+.5,736.5,64,56))return y[n]}(0,t)??m}(X)}function Q(t){H=t.sub(X.sub(new u(250,400)).mul(1/W));const[e,n]=R();H=H.ensureWithin(e+251/W,401/W-1200,n-e-502/W,2400-802/W),H=new u(Math.round(H.x*W)/W,Math.round(H.y*W)/W)}function U(){$=u.empty,G=u.empty,z=void 0,C=void 0,J=!1}function V(){Y.resetTransform()}document.title="space-td";let Z=0;document.body.style.background="#49f",document.body.append(I),document.addEventListener("mousemove",(t=>{K(t),!J&&$.distance(X)>5&&(J=!0),J&&Q(G)})),I.addEventListener("contextmenu",(t=>{t.preventDefault()})),I.addEventListener("wheel",(t=>{K(t),q||function({deltaY:t}){W=Math.max(.5,Math.min(1.5,W-.08333333333333333*Math.sign(t))),Q(F)}(t)})),I.addEventListener("mousedown",(t=>{t.preventDefault(),K(t),q?C=q:($=X,G=F,z=O(F))})),document.addEventListener("mouseup",(t=>{K(t),q&&q===C?(E(void 0),v(q)):J||z!==O(F)||E(z),U()})),document.addEventListener("visibilitychange",(()=>{X=u.empty,F=u.empty,q=void 0,U()})),o("objects",((t,{position:e,x1:n,x2:i})=>{const o=f(n),s=f(i);for(let n=o;n<=s;n+=-1===n?3:1){const i=S.get(n);if(!i){T&&N(t,n,e);continue}const o=new u(24*n,-c[i].height);c[i].draw(t,o);const s=e.within(o.x,o.y,c[i].width,c[i].height);(n===k||s)&&h(t,o,c[i])}})),o("ground",((t,{x1:e,x2:n})=>{const i=f(e),o=f(n);t.fillStyle="sienna";for(let e=i;e<=o;e+=-1===e?2:1)t.fillRect(24*e,0,24,24)})),function e(i){requestAnimationFrame(e),i>=Z+15.666666666666668&&(Z=i,a+=1,function(){!function(){if(Math.random()>.05||L.size>=80)return;const t=s(1,4),e=s(-A,A),n=Math.round(1.5**(t+5)),i={mass:t,position:new u(s(...R())+-1300*Math.tan(e),-1300),r:0,dPosition:new u(Math.sin(e),Math.cos(e)).mul(s(1,2)/t),dr:Math.sign(Math.random()-.5)*s(.01,.04),drawableHandle:o("objects",((t,{x1:e,y1:o,width:s,height:f})=>{if(i.position.within(e-n,o-n,s+2*n,f+2*n)){t.fillStyle="#000",t.strokeStyle="#fff",t.beginPath();for(let e=0;e<i.vertexOffsets.length;e+=1){const o=i.vertexOffsets[e]*n,s=i.r+2*Math.PI*(e/i.vertexOffsets.length),f=i.position.x+Math.sin(s)*o,r=i.position.y+Math.cos(s)*o;0===e?t.moveTo(f,r):t.lineTo(f,r)}t.closePath(),t.fill(),t.stroke()}})),vertexOffsets:D(t)};L.add(i)}();for(const t of L)t.position=t.position.add(t.dPosition),t.r+=t.dr,P(t)}(),V(),Y.clearRect(0,0,500,800),Y.translate(250,400),Y.scale(W,W),Y.translate(-H.x,-H.y),function(e,i){const o=t.map((()=>[]));for(const[t,e]of n.values())o[t].push(e);for(const t of o)for(const n of t)n(e,i)}(Y,{position:F,x1:H.x-251/W,y1:H.y-401/W,x2:H.x+251/W,y2:H.y+305/W,width:502/W,height:706/W}),V(),function(t,e){t.fillStyle="#000",t.fillRect(0,704,500,96),t.strokeStyle="#fff",t.strokeRect(.5,704.5,499,95),function(t,e){t.font="12px monospace",t.textAlign="left",t.textBaseline="middle";let n=0;for(const i of w){const o=i===M,s="tab"===e?.type&&e.name===i;t.fillStyle=o?"#fff":s?"#fff4":"#000",t.fillRect(n+.5,704.5,p[i].width,24),t.fillStyle=o?"#000":"#fff",t.fillText(i,n+8,717.5),t.strokeStyle="#fff",t.strokeRect(n+.5,704.5,p[i].width,24),n+=p[i].width}}(t,e),p[M].draw(t,e)}(Y,q))}(0);})()</script>
