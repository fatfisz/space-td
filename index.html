<meta charset="utf-8"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{image-rendering:pixelated;left:50%;max-height:49%;max-width:49%;position:fixed;top:50%;transform:translate(-50%,-50%)scale(2,2)}</style><body><script>(()=>{"use strict";function t(t,e,n=!1){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d");return o.imageSmoothingEnabled=n,[i,o]}const e=["objects","ground","grid"],n=Object.fromEntries(e.map(((t,e)=>[t,e]))),i=new Map;let o=0;function s(t,e){return o+=1,i.set(o,[n[t],e]),o}function f(t){return Math.floor(t/24)}let l=0;const r={solar:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŒž",e+12,n+12+1)},width:24,height:24},battery:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”‹",e+12,n+12+1)},width:24,height:24},turret:{draw:(t,{x:e,y:n})=>{t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”«",e+12,n+12+1)},width:24,height:24}},c={base:{draw:(t,{x:e,y:n})=>{t.font="60px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ—¼",e+36,n+36+3)},width:72,height:72},...r},a={...r};function d(t,{x:e,y:n},{width:i,height:o}){t.strokeStyle="#fff",t.setLineDash([5,5]),t.lineDashOffset=Math.floor(l/60*-20),t.strokeRect(e+.5,n+.5,i-1,o-1),t.setLineDash([])}class u{x;y;constructor(t,e){this.x=t,this.y=e}add(t){return new u(this.x+t.x,this.y+t.y)}mul(t){return new u(this.x*t,this.y*t)}sub(t){return new u(this.x-t.x,this.y-t.y)}round(){return new u(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance(t){return((this.x-t.x)**2+(this.y-t.y)**2)**.5}empty(){return isNaN(this.x)||isNaN(this.y)}within(t,e,n,i){return this.x>=t&&this.x<t+n&&this.y>=e&&this.y<e+i}static zero=new u(0,0);static empty=new u(NaN,NaN)}const h=new Map([[-1,"base"]]);let m,y;function x(t,e,n){const i=n.within(24*e,-24,24,24);t.strokeStyle=i?"#fff":"#fff8",t.beginPath(),t.arc(24*(e+.5),-12,8,0,2*Math.PI),t.moveTo(24*(e+.3),-12),t.lineTo(24*(e+.7),-12),t.moveTo(24*(e+.5),24*-.3),t.lineTo(24*(e+.5),24*-.7),t.stroke()}function p({x:t,y:e}){const n=f(t),i=n>-1&&n<2?-1:n,o=h.get(i);if(e<=0&&e>=-(o?c[o].height:24))return i}const w={type:"menu"},g=Object.entries(a),b=Object.fromEntries(g.map((([t])=>[t,M(t)]))),v={build:k("build",((t,e)=>{for(const[n,[i,{draw:o,width:s}]]of g.entries()){const f=8+72*n+.5,l=i===y,r="menuBuildObject"===e?.type&&e.name===i;t.fillStyle=l?"#fff":r?"#fff4":"#000",t.fillRect(f,736.5,64,56),t.strokeStyle="#fff",t.strokeRect(f,736.5,64,56),t.fillStyle=l?"#000":"#fff",t.font="12px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(i,f+32,749.5),o(t,new u(f+(64-s)/2,760.5))}})),info:k("info",(t=>{const e=void 0!==m?h.get(m):void 0;t.font="12px monospace",t.textAlign="left",t.textBaseline="top",t.fillStyle="#fff",t.fillText(e?`Selected object: ${e}`:"select an object to see more details",8,736,484)}))},S=Object.keys(v);function k(e,n){const[,i]=t(1e3,1e3);return i.font="12px monospace",{draw:n,menuItem:{type:"tab",name:e},width:Math.round(i.measureText(e).width)+16-1}}function M(t){return{type:"menuBuildObject",name:t}}let T="build";function B(t){"tab"===t.type&&(T=t.name),"menuBuildObject"===t.type&&(y=t.name)}const[N,j]=t(500,800);N.style.background="#000";let E,R,A,L=new u(12,-160),O=1,D=u.empty,I=u.empty,Y=u.empty,q=u.empty,C=!1;function P({clientX:t,clientY:e}={clientX:NaN,clientY:NaN}){const n=N.getBoundingClientRect();D=new u(500/n.width*(t-n.left),800/n.height*(e-n.top)),I=D.sub(new u(250,400)).mul(1/O).add(L),E=function(t){if(!(t.y<704))return function(t){let e=0;for(const n of S){if(t.within(e,704,v[n].width,24))return v[n].menuItem;e+=v[n].width}}(t)??function(t,e){if("build"===T)for(const[t,[n]]of g.entries())if(e.within(8+72*t+.5,736.5,64,56))return b[n]}(0,t)??w}(D)}function X(t){return t.sub(D.sub(new u(250,400)).mul(1/O))}function z(){Y=u.empty,q=u.empty,R=void 0,A=void 0,C=!1}function F(){j.resetTransform()}document.title="space-td";let $=0;document.body.style.background="#49f",document.body.append(N),document.addEventListener("mousemove",(t=>{P(t),!C&&Y.distance(D)>5&&(C=!0),C&&(L=X(q))})),N.addEventListener("contextmenu",(t=>{t.preventDefault()})),N.addEventListener("wheel",(t=>{P(t),E||function({deltaY:t}){O=Math.max(.5,Math.min(1.5,O-.125*Math.sign(t))),L=X(I),L=new u(Math.round(L.x*O)/O,Math.round(L.y*O)/O)}(t)})),N.addEventListener("mousedown",(t=>{t.preventDefault(),P(t),E?A=E:(Y=D,q=I,R=p(I))})),document.addEventListener("mouseup",(t=>{var e;P(t),E&&E===A?B(E):C||R!==p(I)||(void 0===(e=R)?(m=void 0,y=void 0):h.has(e)?(m=e,B({type:"tab",name:"info"})):y&&function(t,e){h.set(t,y)}(e)),z()})),document.addEventListener("visibilitychange",(()=>{D=u.empty,I=u.empty,E=void 0,z()})),s("objects",((t,{position:e,x1:n,x2:i})=>{const o=f(n),s=f(i);for(let n=o;n<=s;n+=-1===n?3:1){const i=h.get(n);if(!i){y&&x(t,n,e);continue}const o=new u(24*n,-c[i].height);c[i].draw(t,o);const s=e.within(o.x,o.y,c[i].width,c[i].height);(n===m||s)&&d(t,o,c[i])}})),s("ground",((t,{x1:e,x2:n})=>{const i=f(e),o=f(n);t.fillStyle="sienna";for(let e=i;e<=o;e+=-1===e?2:1)t.fillRect(24*e,0,24,24)})),function t(n){requestAnimationFrame(t),n>=$+15.666666666666668&&($=n,l+=1,F(),j.clearRect(0,0,500,800),j.translate(250,400),j.scale(O,O),j.translate(-L.x,-L.y),function(t,n){const o=e.map((()=>[]));for(const[t,e]of i.values())o[t].push(e);for(const e of o)for(const i of e)i(t,n)}(j,{position:I,x1:L.x-251/O,y1:L.y-401/O,x2:L.x+251/O,y2:L.y+305/O,width:502/O,height:706/O}),F(),function(t,e){t.fillStyle="#000",t.fillRect(0,704,500,96),t.strokeStyle="#fff",t.strokeRect(.5,704.5,499,95),function(t,e){t.font="12px monospace",t.textAlign="left",t.textBaseline="middle";let n=0;for(const i of S){const o=i===T,s="tab"===e?.type&&e.name===i;t.fillStyle=o?"#fff":s?"#fff4":"#000",t.fillRect(n+.5,704.5,v[i].width,24),t.fillStyle=o?"#000":"#fff",t.fillText(i,n+8,717.5),t.strokeStyle="#fff",t.strokeRect(n+.5,704.5,v[i].width,24),n+=v[i].width}}(t,e),v[T].draw(t,e)}(j,E))}(0);})()</script>
