<meta charset="utf-8"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{image-rendering:pixelated;left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%)scale(3,3)}</style><body><script>(()=>{"use strict";const t=["objects","grid"],e=Object.fromEntries(t.map(((t,e)=>[t,e]))),n=new Map;let i=0;function l(t,l){return i+=1,n.set(i,[e[t],l]),i}class o{x;y;constructor(t,e){this.x=t,this.y=e}add(t){return new o(this.x+t.x,this.y+t.y)}mul(t){return new o(this.x*t,this.y*t)}sub(t){return new o(this.x-t.x,this.y-t.y)}round(){return new o(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance(t){return((this.x-t.x)**2+(this.y-t.y)**2)**.5}empty(){return isNaN(this.x)||isNaN(this.y)}static zero=new o(0,0);static empty=new o(NaN,NaN)}const[s,r]=function(t,e,n=!1){const i=document.createElement("canvas");i.width=t,i.height=e;const l=i.getContext("2d");return l.imageSmoothingEnabled=n,[i,l]}(320,320);s.style.background="#000";let a=o.zero,c=1,d=o.empty,h=o.empty,u=o.empty,y=o.empty,f=!1;function m(t={clientX:NaN,clientY:NaN}){const e=s.getBoundingClientRect();d=new o(320/e.width*(t.clientX-e.left),320/e.height*(t.clientY-e.top)),h=d.sub(new o(160,160)).mul(1/c).add(a)}function x(t){return t.sub(d.sub(new o(160,160)).mul(1/c))}function w(t){return Math.floor(t/16)}function p(t,e=0){return 16*(w(t)+e)}let g=0;const b=new Set([["base",new o(-1,-3)],["solar",new o(-2,-1)],["battery",new o(-3,-1)],["turret",new o(-4,-1)]]),v={base:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(16*e,16*n,48,48),t.fillStyle="white",t.font="12px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ’©",16*(e+1.5),16*(n+1.5))},width:3,height:3},solar:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(16*e,16*n,16,16),t.fillStyle="white",t.font="12px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŒž",16*(e+.5),16*(n+.5))},width:1,height:1},battery:{draw:(t,{x:e,y:n})=>{t.fillStyle="lightblue",t.fillRect(16*e,16*n,16,16),t.fillStyle="white",t.font="12px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”‹",16*(e+.5),16*(n+.5))},width:1,height:1},turret:{draw:(t,{x:e,y:n})=>{t.fillStyle="salmon",t.fillRect(16*e,16*n,16,16),t.fillStyle="white",t.font="12px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸ”«",16*(e+.5),16*(n+.5))},width:1,height:1}};function E(t,{x:e,y:n},{width:i,height:l}){t.strokeStyle="white",t.setLineDash([5,5]),t.lineDashOffset=Math.floor(g/60*-20),t.strokeRect(16*e+.5,16*n+.5,16*i-1,16*l-1),t.setLineDash([])}function N(t,e,n,i,l,o){return t>=n&&t<l&&e>=i&&e<o}document.title="space-td";let S=0;document.body.append(s),s.addEventListener("mousemove",m),document.addEventListener("mousemove",(t=>{u.empty()||(m(t),!f&&u.distance(d)>5&&(f=!0),f&&(a=x(y),m(t)))})),s.addEventListener("contextmenu",(t=>{t.preventDefault()})),s.addEventListener("wheel",(t=>{c=Math.max(.5,Math.min(1,c-.0625*Math.sign(t.deltaY))),a=x(h)})),s.addEventListener("mouseout",(()=>{f||m()})),s.addEventListener("mousedown",(t=>{t.preventDefault(),m(t),u=d,y=h})),s.addEventListener("mouseup",m),document.addEventListener("mouseup",(()=>{!d.empty()&&(d.x<0||d.y<0||d.x>320||d.y>320)&&m(),u=o.empty,y=o.empty,f=!1})),document.addEventListener("visibilitychange",(()=>{m(),u=o.empty,y=o.empty,f=!1})),l("objects",((t,{x:e,y:n})=>{const i=w(e),l=w(n);for(const[e,n]of b)v[e].draw(t,n),N(i,l,n.x,n.y,n.x+v[e].width,n.y+v[e].height)&&E(t,n,v[e])})),l("grid",((t,{x1:e,y1:n,x2:i,y2:l})=>{t.beginPath();for(let o=p(e);o<i;o+=16)t.moveTo(o,n),t.lineTo(o,l);for(let o=p(n);o<l;o+=16)t.moveTo(e,o),t.lineTo(i,o);t.lineWidth=1,t.strokeStyle="#fff3",t.stroke()})),function e(i){requestAnimationFrame(e),i>=S+15.666666666666668&&(S=i,g+=1,r.resetTransform(),r.clearRect(0,0,320,320),r.translate(160,160),r.scale(c,c),r.translate(-a.x,-a.y),function(e,i){const l=t.map((()=>[]));for(const[t,e]of n.values())l[t].push(e);for(const t of l)for(const n of t)n(e,i)}(r,{x:h.x,y:h.y,x1:a.x-161/c,y1:a.y-161/c,x2:a.x+161/c,y2:a.y+161/c}))}(0);})()</script>
